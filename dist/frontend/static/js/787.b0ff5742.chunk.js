(self.webpackChunksocial_network_client=self.webpackChunksocial_network_client||[]).push([[787],{65614:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>D});s(43161),s(43663);var n=s(72791),i=s(66826),o=s(91460),a=s(40834),r=s(62836),c=s(94018),l=s.n(c),h=(s(89390),s(29679)),p=s(82288),d=s(44102),u=s(72898);const g="image/x-png, image/png, image/jpg, image/jpeg, image/gif",m=g.split(",").map((t=>t.trim()));class S extends n.PureComponent{constructor(){super(...arguments),this.imagePreviewCanvasRef=n.createRef(),this.fileInputRef=n.createRef(),this.state={crop:{aspect:1}},this.componentDidMount=()=>{const{dispatch:t}=this.props;t(p.r.canvasHasValue(!1))},this.handleOnCropChange=t=>{this.setState({crop:t})},this.handleOnCropComplete=(t,e)=>{const{post:{imgSrc:s},dispatch:n}=this.props;n(p.r.canvasHasValue(!0));const i=this.imagePreviewCanvasRef.current;i.width=e.width,i.height=e.height;const o=i.getContext("2d"),a=new Image;a.src=s,a.onload=function(){o.drawImage(a,e.x,e.y,e.width,e.height,0,0,e.width,e.height);const t=i.toDataURL();n(p.r.getCroppedSrc(t))}},this.handleUpload=t=>{t.preventDefault();const{imgSrc:e}=this.props.post;if(e){const t=this.imagePreviewCanvasRef.current,{imgSrcExt:e}=this.props.post,s=t.toDataURL("image/"+e),n="previewFile."+e,i=(0,h.TP)(s,n),o=new FormData;o.append("photo",i,i.name),o.append("description",this.state.description);const{dispatch:a}=this.props;a(p.r.addPost(o))}},this.verifyFile=t=>{if(t&&t.length>0){const e=t[0],s=e.type,n=e.size,{dispatch:i}=this.props;return m.includes(s)?!(n>10485760)||(i(d.I.error("This file is not allowed. "+n+" bytes is too large")),!1):(i(d.I.error("This file is not allowed. Only images are allowed.")),!1)}},this.handleFileSelect=t=>{const{dispatch:e}=this.props,s=t.target.files;if(s&&s.length>0){if(this.verifyFile(s)){const t=s[0],n=new FileReader;n.addEventListener("load",(()=>{const t=n.result;e(p.r.selectImage(t,(0,h.FN)(t))),this.setState({imgSrc:t,imgSrcExt:(0,h.FN)(t)})}),!1),n.readAsDataURL(t)}}},this.changeAspect=t=>{"1:1"===t.target.name?this.setState({crop:{...this.state.crop,aspect:1}}):this.setState({crop:{...this.state.crop,aspect:16/9}})},this.resetReducer=()=>{const{dispatch:t}=this.props;t({type:"RESET_IMAGE"})}}render(){const{imgSrc:t}=this.props.post;return(0,u.jsx)("div",{className:"post-crop",children:null!==t?(0,u.jsxs)("div",{children:[(0,u.jsxs)("div",{style:{padding:"1% 0",display:"grid",gridTemplateColumns:"1fr auto",gridColumnGap:"1rem"},children:[(0,u.jsx)("div",{children:(0,u.jsxs)("label",{className:"ui massive fluid icon button",children:[(0,u.jsx)("i",{className:"file icon"}),"Change Image",(0,u.jsx)("input",{style:{display:"none"},ref:this.fileInputRef,type:"file",accept:g,multiple:!1,onChange:this.handleFileSelect})]})}),(0,u.jsxs)("div",{children:[(0,u.jsx)(a.Z,{onClick:this.changeAspect,name:"1:1",size:"massive",children:"1:1"}),(0,u.jsx)(a.Z,{onClick:this.changeAspect,name:"16:9",size:"massive",children:"16:9"}),(0,u.jsx)(a.Z,{onClick:this.resetReducer,icon:"close",size:"massive"})]})]}),(0,u.jsx)(l(),{src:t,crop:this.state.crop,onComplete:this.handleOnCropComplete,onChange:this.handleOnCropChange}),(0,u.jsx)("canvas",{id:"cropped-image-canvas",ref:this.imagePreviewCanvasRef,style:{display:"none"}})]}):(0,u.jsx)("div",{style:{padding:"1% 0"},children:(0,u.jsxs)("label",{className:"ui massive fluid icon button",children:[(0,u.jsx)("i",{className:"file icon"}),"Select Image",(0,u.jsx)("input",{style:{display:"none"},ref:this.fileInputRef,type:"file",accept:g,multiple:!1,onChange:this.handleFileSelect})]})})})}}const f=(0,i.$j)((t=>({post:t.postUpload})))(S);var y=s(31184),x=s(57570),C=s(46992);class v extends n.Component{constructor(){super(...arguments),this.state={viewport:{latitude:37.7577,longitude:-122.4376,zoom:8},searchResultLayer:null},this.mapRef=n.createRef(),this.handleViewportChange=t=>{this.setState({viewport:{...this.state.viewport,...t}})},this.handleGeocoderViewportChange=t=>this.handleViewportChange({...t,transitionDuration:1e3}),this.handleOnResult=t=>{const{text:e,geometry:s}=t.result,{dispatch:n}=this.props;n(p.r.mapLoactionSelect({text:e,geometry:s})),this.setState({searchResultLayer:new C.Z({id:"search-result",data:t.result.geometry,getFillColor:[255,0,0,128],getRadius:1e3,pointRadiusMinPixels:10,pointRadiusMaxPixels:10})})}}render(){const{viewport:t}=this.state;return(0,u.jsx)(y.ZP,{ref:this.mapRef,mapboxApiAccessToken:"pk.eyJ1Ijoiam9obmJvcyIsImEiOiJjanl1b3l1MmkwaDdnM2pwaG5yNm1mZmlrIn0.O7X5QEcRO2ncLo_vLMVeTQ",width:"100%",height:"35rem",...t,onViewportChange:this.handleViewportChange,children:(0,u.jsx)(x.Z,{limit:5,mapRef:this.mapRef,onResult:this.handleOnResult,onViewportChange:this.handleGeocoderViewportChange,mapboxApiAccessToken:"pk.eyJ1Ijoiam9obmJvcyIsImEiOiJjanl1b3l1MmkwaDdnM2pwaG5yNm1mZmlrIn0.O7X5QEcRO2ncLo_vLMVeTQ"})})}}const P=(0,i.$j)(null)(v);var T=s(72447),j=s(3982),I=s.n(j),O=(s(65568),s(86559));class E extends n.Component{constructor(){super(),this.handleChange=t=>{this.setState({value:t})},this.handleSubmit=()=>{const{dispatch:t,imgSrcExt:e,cropImgSrc:s,location:n,divs:i}=this.props,o=s,a="image."+e,r=(0,h.TP)(o,a),c=new FormData;c.append("photo",r,r.name),c.append("description",this.state.value),c.append("tags",JSON.stringify(i)),Object.keys(n).forEach((t=>c.append(t,n[t]))),t(p.r.addPost(c))},this.handleRequestOptions=t=>{this.setState({part:t}),""!==t&&function(t){const e={method:"POST",headers:{Authorization:JSON.parse(localStorage.getItem("user")).token,"Content-Type":"application/json"},body:JSON.stringify({q:t})};return fetch("/api/user/searchByUsername",e).then((t=>t))}(t).then((e=>{t===this.state.part?e.json().then((t=>{this.setState({isLoading:!1,suggestions:t.users.map((t=>t.username))})})):this.setState({isLoading:!1})}))},this.state={value:"",part:"",suggestions:[]},this.debouncedRequestOptions=(0,O.D)(500,this.handleRequestOptions)}render(){const{value:t,suggestions:e}=this.state;return(0,u.jsx)(n.Fragment,{children:(0,u.jsxs)(T.Z,{size:"big",onSubmit:this.handleSubmit,children:[(0,u.jsxs)(T.Z.Field,{children:[(0,u.jsx)("label",{children:"Description"}),(0,u.jsx)(I(),{maxOptions:8,offsetY:20,minChars:1,value:t,onRequestOptions:this.debouncedRequestOptions,options:e,onChange:this.handleChange,placeholder:"Description",type:"textarea",name:"description",style:{minHeight:100,maxHeight:100}})]}),(0,u.jsx)(a.Z,{primary:!0,fluid:!0,size:"big",children:"Upload"})]})})}}const N=(0,i.$j)((t=>{const{imgSrcExt:e,cropImgSrc:s,location:n,divs:i}=t.postUpload;return{imgSrcExt:e,cropImgSrc:s,location:n,divs:i}}))(E);var A=s(24610),k=s.n(A),_=s(68285);class w extends n.Component{constructor(){super(...arguments),this.state={x:0,y:0,value:"",displayInput:"none",submitOnClick:!1,open:!0},this.handleChange=t=>{this.setState({value:t,submitOnClick:!1})},this.deleteTag=t=>{const{dispatch:e}=this.props;e({type:"DELETE_IMAGE_TAG",id:t.target.id})},this.handleAddAutocompleteTag=t=>{const{x:e,y:s}=this.state,{dispatch:n}=this.props;""!==t&&(n({type:"ADD_IMAGE_TAG",div:{x:e,y:s,value:t,id:k().v4()}}),this.setState({displayInput:"none",submitOnClick:!0}))},this.handleAddTag=()=>{const{x:t,y:e,value:s}=this.state,{dispatch:n}=this.props;""!==s&&(n({type:"ADD_IMAGE_TAG",div:{x:t,y:e,value:s,id:k().v4()}}),this.setState({submitOnClick:!0,displayInput:"none"}))},this.handleClick=t=>{const e=Math.floor(100*t.nativeEvent.offsetX/t.target.width),s=Math.floor(100*t.nativeEvent.offsetY/t.target.height);this.setState({x:e,y:s,displayInput:"inline-block"})}}render(){const{cropImgSrc:t,divs:e}=this.props,{x:s,y:i,submitOnClick:o,displayInput:c}=this.state,l=e.map((t=>(0,u.jsx)("div",{className:"text-box",style:{top:t.y+"%",left:t.x+"%"},children:(0,u.jsxs)("div",{className:"tooltip tooltip-top",children:[t.value,(0,u.jsx)(r.Z,{id:t.id,onClick:this.deleteTag,style:{cursor:"pointer",marginLeft:"2px",color:"red"},name:"close"})]})},t.id)));return(0,u.jsx)(n.Fragment,{children:(0,u.jsxs)("div",{className:"add-image-tags",children:[(0,u.jsx)("div",{className:"text-box",style:{top:i+"%",left:s+"%"},children:(0,u.jsx)("div",{className:"tooltip tooltip-top",style:{display:c},children:(0,u.jsxs)("div",{className:"add-tag-input",children:[(0,u.jsx)(_.L,{addTagPage:!0,submitOnClick:o,handleChange:this.handleChange,addAutocompleteTag:this.handleAddAutocompleteTag}),(0,u.jsx)(a.Z,{onClick:this.handleAddTag,children:"Add"})]})})}),(0,u.jsx)("img",{alt:"",onClick:this.handleClick,style:{width:"100%",height:"auto"},src:t}),l]})})}}const R=(0,i.$j)((t=>({divs:t.postUpload.divs})))(w);var b=s(85168);function L(){return(0,u.jsx)(f,{})}function q(t){let{cropImgSrc:e,message:s}=t;return(0,u.jsxs)("div",{className:"edit-post",children:[s,(0,u.jsx)(R,{cropImgSrc:e}),(0,u.jsx)("div",{children:(0,u.jsx)(o.Z,{size:"large",color:"blue",children:"Click on image to tag people"})}),(0,u.jsx)("div",{children:(0,u.jsx)(P,{})}),(0,u.jsxs)("div",{children:[(0,u.jsx)(o.Z,{size:"large",color:"blue",children:"Type @ to get suggestions"}),(0,u.jsx)(N,{})]})]})}class F extends n.Component{constructor(){super(...arguments),this.state={step:0},this.componentDidMount=()=>{document.title="Upload | social-network"},this.handlePreviousClick=()=>{const{dispatch:t}=this.props;t({type:"PREVIOUS_PAGE"})},this.handleNextClick=()=>{const{dispatch:t}=this.props;t({type:"NEXT_PAGE"})}}render(){let t=null;const{canvasHasValue:e,cropImgSrc:s,step:n,uploading:i}=this.props.post,{alert:o}=this.props;return 0===n?t=(0,u.jsx)(L,{}):1===n&&(t=(0,u.jsx)(q,{cropImgSrc:s})),(0,u.jsxs)("div",{className:"container",children:[i?(0,u.jsx)("div",{className:"fullscreen-loader",children:"Loading\u2026"}):null,o.type?(0,u.jsx)(b.Z,{alert:o}):null,t,1===n?(0,u.jsxs)(a.Z,{style:{marginBottom:"30px"},icon:!0,labelPosition:"left",size:"huge",fluid:!0,onClick:this.handlePreviousClick,children:["Previous",(0,u.jsx)(r.Z,{name:"left arrow"})]}):null,e&&0===n?(0,u.jsxs)(a.Z,{icon:!0,labelPosition:"right",size:"huge",fluid:!0,onClick:this.handleNextClick,children:["Next",(0,u.jsx)(r.Z,{name:"right arrow"})]}):null]})}}const D=(0,i.$j)((t=>({post:t.postUpload,alert:t.alert})))(F)},82288:(t,e,s)=>{"use strict";s.d(e,{r:()=>l});var n=s(73685),i=s(51935);const o={fetchPosts:function(t){const e={method:"POST",headers:{"Content-Type":"application/json",Authorization:JSON.parse(localStorage.getItem("user")).token},body:JSON.stringify({...t})};return fetch("/api/post/getPosts/",e).then(r).then((t=>t.data))},getPostsByHashtag:function(t,e){const s={method:"POST",headers:{"Content-Type":"application/json",Authorization:JSON.parse(localStorage.getItem("user")).token},body:JSON.stringify({hashtag:t,...e})};return fetch("/api/post/getPostsByHashtag/",s).then(r).then((t=>t.data))},getPostsByLocation:function(t,e){const s={method:"POST",headers:{"Content-Type":"application/json",Authorization:JSON.parse(localStorage.getItem("user")).token},body:JSON.stringify({coordinates:t,...e})};return fetch("/api/post/getPostsByLocation/",s).then(r).then((t=>t.data))},addPost:function(t){const e={method:"POST",headers:{Authorization:JSON.parse(localStorage.getItem("user")).token},body:t};return fetch("/api/post/addPost/",e).then(r).then((t=>t.post))},addProfiePicture:function(t){const e={method:"POST",headers:{Authorization:JSON.parse(localStorage.getItem("user")).token},body:t};return fetch("/api/user/addProfiePicture/",e).then(r).then((t=>t))},deletePost:function(t){const e={method:"POST",headers:{"Content-Type":"application/json",Authorization:JSON.parse(localStorage.getItem("user")).token},body:JSON.stringify({postId:t})};return fetch("/api/post/delete/",e).then(r).then((t=>t))},likePost:function(t,e){const s={method:"POST",headers:{"Content-Type":"application/json",Authorization:JSON.parse(localStorage.getItem("user")).token},body:JSON.stringify({postId:t,authorId:e})};return fetch("/api/post/likePost/",s).then(r).then((t=>t))},getPostLikes:function(t){const e={method:"POST",headers:{"Content-Type":"application/json",Authorization:JSON.parse(localStorage.getItem("user")).token},body:JSON.stringify({postId:t})};return fetch("/api/post/getPostLikes/",e).then(r).then((t=>t))},getPost:function(t){const e={method:"POST",headers:{"Content-Type":"application/json",Authorization:JSON.parse(localStorage.getItem("user")).token},body:JSON.stringify({postId:t})};return fetch("/api/post/getPost/",e).then(r).then((t=>t))},logout:a};function a(){localStorage.removeItem("user")}function r(t){return t.text().then((e=>{const s=e&&JSON.parse(e);if(!t.ok){401===t.status&&(console.log(t),a(),window.location.reload(!0));const e=s&&s.message||t.statusText;return Promise.reject(e)}return s}))}var c=s(44102);const l={mapLoactionSelect:function(t){return e=>{e({type:n.q.MAP_LOCATION_SELECT,location:t})}},changeTextareaValue:function(t){return e=>{e({type:n.q.TEXTAREA_VALUE_CAHNGE,value:t})}},canvasHasValue:function(t){return e=>{e({type:n.q.CANVAS_HAS_VALUE,hasValue:t})}},getCroppedSrc:function(t){return e=>{e({type:n.q.IMAGE_CROP_SELECT,imgSrc:t})}},selectImage:function(t,e){return s=>{s({type:n.q.IMAGE_SELECT,imgSrc:t,imgSrcExt:e})}},fetchPosts:function(t){return s=>{o.fetchPosts(t).then((i=>{if(t.initialFetch){const{posts:o,total:a}=i[0];o.forEach((t=>s({type:n.q.INIT_COMMENT,postId:t._id}))),s(e(o,a[0],t.initialFetch))}else s(e(i)),i.forEach((t=>s({type:n.q.INIT_COMMENT,postId:t._id})))}),(t=>{s(c.I.error(t))}))};function e(t,e,s){return{type:n.q.POSTS_SUCCESS,posts:t,total:e,initialFetch:s}}},getPostsByHashtag:function(t,e){return i=>{var a;i((a=e.initialFetch,{type:n.q.HASHTAG_POSTS_REQUEST,initialFetch:a})),o.getPostsByHashtag(t,e).then((n=>{if(e.initialFetch){const{posts:o,total:a}=n[0];i(s(o,a[0],e.initialFetch,t))}else i(s(n))}),(t=>{i(c.I.error(t))}))};function s(t,e,s,i){return{type:n.q.HASHTAG_POSTS_SUCCESS,posts:t,total:e,initialFetch:s,hashtag:i}}},getPostsByLocation:function(t,e){return i=>{var a;i((a=e.initialFetch,{type:n.q.LOCATION_POSTS_REQUEST,initialFetch:a})),o.getPostsByLocation(t,e).then((n=>{if(e.initialFetch){const{posts:o,total:a}=n[0];i(s(o,a[0],e.initialFetch,t))}else i(s(n))}),(t=>{i(c.I.error(t))}))};function s(t,e,s,i){return{type:n.q.LOCATION_POSTS_SUCCESS,posts:t,total:e,initialFetch:s,coordinates:i}}},deletePost:function(t){return e=>{e({type:n.q.POST_DELETE_REQUEST}),o.deletePost(t).then((t=>{var s;e((s=t,{type:n.q.POST_DELETE_SUCCESS,result:s})),e(c.I.success(t.message))}),(t=>{console.log(t)}))}},addPost:function(t){return e=>{e({type:n.q.ADD_POST_REQUEST}),o.addPost(t).then((t=>{e(function(t){return{type:n.q.ADD_POST_SUCCESS,post:t}}(t)),e(c.I.success("Post uploaded")),e({type:n.q.INIT_COMMENT,postId:t._id})}),(t=>{e(c.I.error(t))}))}},addProfiePicture:function(t){return e=>{e({type:i.A.GETUSER_REQUEST}),o.addProfiePicture(t).then((t=>{var s;e((s=t.user,{type:i.A.USER_UPDATE_PROFILEPICTURE_SUCCESS,user:s}))}),(t=>{console.log(t)}))}},likePost:function(t,e,s){return a=>{s.some((e=>e===t))?a(i(n.q.DISLIKE_POST,{postId:t})):a(i(n.q.LIKE_POST,{postId:t})),o.likePost(t,e).then((()=>{}),(t=>{console.log(t)}))};function i(t,e){return{type:t,post:e}}},getPostLikes:function(t){return e=>{o.getPostLikes(t).then((t=>{var s;e((s=t.users[0].users_likes,{type:n.q.GET_POST_LIKES,postLikes:s}))}),(t=>{console.log(t)}))}},getPost:function(t){return e=>{o.getPost(t).then((t=>{var s,i;document.title=t.post[0].author[0].username+"'s post | social-network",e((s=n.q.GET_POST,i=t.post,{type:s,post:i})),e({type:n.q.INIT_COMMENT,postId:t.post[0]._id})}),(t=>{e(c.I.error(t)),console.log(t)}))}}}},68285:(t,e,s)=>{"use strict";s.d(e,{L:()=>m});var n=s(72791),i=s(69986),o=s.n(i),a=s(78417),r=s(74325),c=s(86559),l=s(66826),h=s(72898);function p(t){let{username:e}=t;return e}function d(t){let{firstName:e,lastName:s,username:n,profilePicture:i}=t;return(0,h.jsx)(a.Z,{to:"/"+n,children:(0,h.jsxs)("span",{className:"suggestion-content "+n,children:[(0,h.jsx)("img",{alt:"",src:"/images/profile-picture/100x100/"+i}),(0,h.jsxs)("span",{className:"autosuggestion-name",children:[n,(0,h.jsx)("p",{children:"".concat(e," ").concat(s)})]})]})})}function u(t){let{firstName:e,lastName:s,username:n,profilePicture:i}=t;return(0,h.jsxs)("span",{className:"suggestion-content "+n,children:[(0,h.jsx)("img",{alt:"",src:"/images/profile-picture/100x100/"+i}),(0,h.jsxs)("span",{className:"autosuggestion-name",children:[n,(0,h.jsx)("p",{children:"".concat(e," ").concat(s)})]})]})}class g extends n.Component{constructor(){super(),this.onKeyDown=t=>{const{addTagPage:e}=this.props,{value:s}=this.state;13!==t.keyCode||e||""===s?13===t.keyCode&&e&&this.props.addAutocompleteTag(s):r.m.push("/".concat(s))},this.onChange=(t,e)=>{let{newValue:s}=e;const{addTagPage:n}=this.props;n&&this.props.handleChange(s),this.setState({value:s})},this.onSuggestionsFetchRequested=t=>{let{value:e}=t;this.debouncedLoadSuggestions(e)},this.onSuggestionsClearRequested=()=>{this.setState({suggestions:[]})},this.state={value:"",suggestions:[],isLoading:!1},this.debouncedLoadSuggestions=(0,c.P)(500,this.loadSuggestions)}loadSuggestions(t){const e=document.querySelector(".react-autosuggest__input").classList;e.add("user-suggestion-loading"),this.setState({isLoading:!0}),function(t){const e={method:"POST",headers:{Authorization:JSON.parse(localStorage.getItem("user")).token,"Content-Type":"application/json"},body:JSON.stringify({q:t})};return fetch("/api/user/searchByUsername",e).then((t=>t))}(t).then((s=>{t===this.state.value?s.json().then((t=>{e.remove("user-suggestion-loading"),this.setState({isLoading:!1,suggestions:t.users.map((t=>({firstName:t.firstName,lastName:t.lastName,username:t.username,profilePicture:t.profilePicture})))})})):(e.remove("user-suggestion-loading"),this.setState({isLoading:!1}))}))}render(){const{value:t,suggestions:e}=this.state,{addTagPage:s,submitOnClick:n}=this.props,i={placeholder:"Search",value:n?"":t,onChange:this.onChange,onKeyDown:this.onKeyDown};return(0,h.jsx)(o(),{onKeyDown:this.handleOnKeyDown,suggestions:e,onSuggestionsFetchRequested:this.onSuggestionsFetchRequested,onSuggestionsClearRequested:this.onSuggestionsClearRequested,getSuggestionValue:p,renderSuggestion:s?u:d,inputProps:i})}}const m=(0,l.$j)(null)(g)},85168:(t,e,s)=>{"use strict";s.d(e,{Z:()=>o});s(72791);var n=s(91460),i=s(72898);function o(t){let{alert:{type:e,message:s}}=t;return"success"===e?(0,i.jsx)(n.Z,{success:!0,header:"Success",content:s}):"error"===e?(0,i.jsx)(n.Z,{error:!0,header:"Error",content:s}):null}},29679:(t,e,s)=>{"use strict";function n(t,e){for(var s=t.split(","),n=s[0].match(/:(.*?);/)[1],i=atob(s[1]),o=i.length,a=new Uint8Array(o);o--;)a[o]=i.charCodeAt(o);return new File([a],e,{type:n})}function i(t){return t.substring(11,t.indexOf(";base64"))}function o(t,e,s){const n=t;n.width=s.width,n.height=s.height;const i=n.getContext("2d"),o=new Image;o.src=e,o.onload=function(){i.drawImage(o,s.x,s.y,s.width,s.height,0,0,s.width,s.height)}}s.d(e,{FN:()=>i,TP:()=>n,tI:()=>o})},92378:()=>{},75307:()=>{}}]);
//# sourceMappingURL=787.b0ff5742.chunk.js.map